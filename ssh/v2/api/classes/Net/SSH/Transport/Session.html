<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Net::SSH::Transport::Session</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../../../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Net::SSH::Transport::Session</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../../../files/lib/net/ssh/transport/session_rb.html">
                lib/net/ssh/transport/session.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
The transport layer represents the lowest level of the <a
href="../../SSH.html">SSH</a> protocol, and implements basic message
exchanging and protocol initialization. It will never be instantiated
directly (unless you really know what you&#8216;re about), but will instead
be created for you automatically when you create a <a
href="Session.html#M000040">new</a> <a href="../../SSH.html">SSH</a>
session via <a href="../../SSH.html#M000013">Net::SSH.start</a>.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000043">close</a>&nbsp;&nbsp;
      <a href="#M000042">closed?</a>&nbsp;&nbsp;
      <a href="#M000055">configure_client</a>&nbsp;&nbsp;
      <a href="#M000056">configure_server</a>&nbsp;&nbsp;
      <a href="#M000054">enqueue_message</a>&nbsp;&nbsp;
      <a href="#M000057">hint</a>&nbsp;&nbsp;
      <a href="#M000041">host_as_string</a>&nbsp;&nbsp;
      <a href="#M000040">new</a>&nbsp;&nbsp;
      <a href="#M000049">next_message</a>&nbsp;&nbsp;
      <a href="#M000048">peer</a>&nbsp;&nbsp;
      <a href="#M000050">poll_message</a>&nbsp;&nbsp;
      <a href="#M000052">push</a>&nbsp;&nbsp;
      <a href="#M000046">rekey!</a>&nbsp;&nbsp;
      <a href="#M000047">rekey_as_needed</a>&nbsp;&nbsp;
      <a href="#M000053">send_message</a>&nbsp;&nbsp;
      <a href="#M000045">service_request</a>&nbsp;&nbsp;
      <a href="#M000044">shutdown!</a>&nbsp;&nbsp;
      <a href="#M000051">wait</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->
    <div id="includes">
      <h3 class="section-bar">Included Modules</h3>

      <div id="includes-list">
        <span class="include-name"><a href="Constants.html">Constants</a></span>
        <span class="include-name"><a href="../Loggable.html">Loggable</a></span>
      </div>
    </div>

    <div id="section">


    <div id="constants-list">
      <h3 class="section-bar">Constants</h3>

      <div class="name-list">
        <table summary="Constants">
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">DEFAULT_PORT</td>
          <td>=</td>
          <td class="context-item-value">22</td>
          <td width="3em">&nbsp;</td>
          <td class="context-item-desc">
The standard port for the <a href="../../SSH.html">SSH</a> protocol.

</td>
        </tr>
        </table>
      </div>
    </div>



    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">algorithms</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="Algorithms.html">Algorithms</a> instance used to perform key
exchanges.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">host</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The host to connect to, as given to the constructor.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">host_key_verifier</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The host-key verifier object used to verify host keys, to ensure that the
connection is not being spoofed.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">options</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The hash of options that were given to the object at initialization.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">port</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The port number to connect to, as given in the options to the constructor.
If no port number was given, this will default to DEFAULT_PORT.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">server_version</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The <a href="ServerVersion.html">ServerVersion</a> instance that
encapsulates the negotiated protocol version.

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">socket</td>
          <td class="context-item-value">&nbsp;[R]&nbsp;</td>
          <td class="context-item-desc">
The underlying socket object being used to communicate with the remote
host.

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000040" class="method-detail">
        <a name="M000040"></a>

        <div class="method-heading">
          <a href="#M000040" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(host, options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Instantiates a <a href="Session.html#M000040">new</a> transport layer
abstraction. This will block until the initial key exchange completes,
leaving you with a ready-to-use transport session.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000040-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000040-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 56</span>
56:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">host</span>, <span class="ruby-identifier">options</span>={})
57:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:logger</span>]
58: 
59:       <span class="ruby-ivar">@host</span> = <span class="ruby-identifier">host</span>
60:       <span class="ruby-ivar">@port</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:port</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">DEFAULT_PORT</span>
61:       <span class="ruby-ivar">@options</span> = <span class="ruby-identifier">options</span>
62: 
63:       <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;establishing connection to #{@host}:#{@port}&quot;</span> }
64:       <span class="ruby-identifier">factory</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:proxy</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">TCPSocket</span>
65:       <span class="ruby-ivar">@socket</span> = <span class="ruby-identifier">timeout</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:timeout</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>) { <span class="ruby-identifier">factory</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@host</span>, <span class="ruby-ivar">@port</span>) }
66:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">extend</span>(<span class="ruby-constant">PacketStream</span>)
67:       <span class="ruby-ivar">@socket</span>.<span class="ruby-identifier">logger</span> = <span class="ruby-ivar">@logger</span>
68: 
69:       <span class="ruby-identifier">debug</span> { <span class="ruby-value str">&quot;connection established&quot;</span> }
70: 
71:       <span class="ruby-ivar">@queue</span> = []
72: 
73:       <span class="ruby-ivar">@host_key_verifier</span> = <span class="ruby-identifier">select_host_key_verifier</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:paranoid</span>])
74: 
75:       <span class="ruby-ivar">@server_version</span> = <span class="ruby-constant">ServerVersion</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">socket</span>, <span class="ruby-identifier">logger</span>)
76: 
77:       <span class="ruby-ivar">@algorithms</span> = <span class="ruby-constant">Algorithms</span>.<span class="ruby-identifier">new</span>(<span class="ruby-keyword kw">self</span>, <span class="ruby-identifier">options</span>)
78:       <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }
79:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000043" class="method-detail">
        <a name="M000043"></a>

        <div class="method-heading">
          <a href="#M000043" class="method-signature">
          <span class="method-name">close</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Cleans up (see <a
href="PacketStream.html#M000033">PacketStream#cleanup</a>) and closes the
underlying socket.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000043-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000043-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 102</span>
102:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">close</span>
103:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">cleanup</span>
104:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>
105:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000042" class="method-detail">
        <a name="M000042"></a>

        <div class="method-heading">
          <a href="#M000042" class="method-signature">
          <span class="method-name">closed?</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns true if the underlying socket has been closed.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000042-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000042-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 97</span>
97:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">closed?</span>
98:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">closed?</span>
99:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000055" class="method-detail">
        <a name="M000055"></a>

        <div class="method-heading">
          <a href="#M000055" class="method-signature">
          <span class="method-name">configure_client</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Configure&#8216;s the packet stream&#8216;s client state with the given set
of options. This is typically used to define the cipher, compression, and
hmac algorithms to use when sending packets to the server.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000055-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000055-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 229</span>
229:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_client</span>(<span class="ruby-identifier">options</span>={})
230:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">client</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)
231:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000056" class="method-detail">
        <a name="M000056"></a>

        <div class="method-heading">
          <a href="#M000056" class="method-signature">
          <span class="method-name">configure_server</span><span class="method-args">(options={})</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Configure&#8216;s the packet stream&#8216;s server state with the given set
of options. This is typically used to define the cipher, compression, and
hmac algorithms to use when reading packets from the server.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000056-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000056-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 236</span>
236:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">configure_server</span>(<span class="ruby-identifier">options</span>={})
237:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">server</span>.<span class="ruby-identifier">set</span>(<span class="ruby-identifier">options</span>)
238:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000054" class="method-detail">
        <a name="M000054"></a>

        <div class="method-heading">
          <a href="#M000054" class="method-signature">
          <span class="method-name">enqueue_message</span><span class="method-args">(message)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Enqueues the given message, such that it will be sent at the earliest
opportunity. This does not block, but returns immediately.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000054-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000054-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 222</span>
222:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">enqueue_message</span>(<span class="ruby-identifier">message</span>)
223:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">enqueue_packet</span>(<span class="ruby-identifier">message</span>)
224:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000057" class="method-detail">
        <a name="M000057"></a>

        <div class="method-heading">
          <a href="#M000057" class="method-signature">
          <span class="method-name">hint</span><span class="method-args">(which, value=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sets a <a href="Session.html#M000040">new</a> <a
href="Session.html#M000057">hint</a> for the packet stream, which the
packet stream may use to change its behavior. (See PacketStream#hints).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000057-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000057-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 242</span>
242:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hint</span>(<span class="ruby-identifier">which</span>, <span class="ruby-identifier">value</span>=<span class="ruby-keyword kw">true</span>)
243:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">hints</span>[<span class="ruby-identifier">which</span>] = <span class="ruby-identifier">value</span>
244:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000041" class="method-detail">
        <a name="M000041"></a>

        <div class="method-heading">
          <a href="#M000041" class="method-signature">
          <span class="method-name">host_as_string</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns the host (and possibly IP address) in a format compatible with <a
href="../../SSH.html">SSH</a> known-host files.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000041-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000041-source">
<pre>
    <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 83</span>
83:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">host_as_string</span>
84:       <span class="ruby-ivar">@host_as_string</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword kw">begin</span>
85:         <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;#{host}&quot;</span>
86:         <span class="ruby-identifier">string</span> = <span class="ruby-node">&quot;[#{string}]:#{port}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>
87:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">host</span>
88:           <span class="ruby-identifier">string2</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>
89:           <span class="ruby-identifier">string2</span> = <span class="ruby-node">&quot;[#{string2}]:#{port}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">port</span> <span class="ruby-operator">!=</span> <span class="ruby-constant">DEFAULT_PORT</span>
90:           <span class="ruby-identifier">string</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-value str">&quot;,&quot;</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">string2</span>
91:         <span class="ruby-keyword kw">end</span>
92:         <span class="ruby-identifier">string</span>
93:       <span class="ruby-keyword kw">end</span>
94:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000049" class="method-detail">
        <a name="M000049"></a>

        <div class="method-heading">
          <a href="#M000049" class="method-signature">
          <span class="method-name">next_message</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Blocks until a <a href="Session.html#M000040">new</a> packet is available
to be read, and returns that packet. See <a
href="Session.html#M000050">poll_message</a>.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000049-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000049-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 148</span>
148:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">next_message</span>
149:       <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">:block</span>)
150:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000048" class="method-detail">
        <a name="M000048"></a>

        <div class="method-heading">
          <a href="#M000048" class="method-signature">
          <span class="method-name">peer</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a hash of information about the <a
href="Session.html#M000048">peer</a> (remote) side of the socket, including
:ip, :port, :host, and :canonized (see <a
href="Session.html#M000041">host_as_string</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000048-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000048-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 142</span>
142:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">peer</span>
143:       <span class="ruby-ivar">@peer</span> <span class="ruby-operator">||=</span> { <span class="ruby-identifier">:ip</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">peer_ip</span>, <span class="ruby-identifier">:port</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@port</span>.<span class="ruby-identifier">to_i</span>, <span class="ruby-identifier">:host</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@host</span>, <span class="ruby-identifier">:canonized</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">host_as_string</span> }
144:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000050" class="method-detail">
        <a name="M000050"></a>

        <div class="method-heading">
          <a href="#M000050" class="method-signature">
          <span class="method-name">poll_message</span><span class="method-args">(mode=:nonblock, consume_queue=true)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Tries to read the next packet from the socket. If mode is :nonblock (the
default), this will not block and will return nil if there are no packets
waiting to be read. Otherwise, this will block until a packet is available.
Note that some packet types (DISCONNECT, IGNORE, UNIMPLEMENTED, DEBUG, and
KEXINIT) are handled silently by this method, and will never be returned.
</p>
<p>
If a key-exchange is in process and a disallowed packet type is received,
it will be enqueued and otherwise ignored. When a key-exchange is not in
process, and consume_queue is true, packets will be first read from the
queue before the socket is queried.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000050-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000050-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 163</span>
163:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">mode</span>=<span class="ruby-identifier">:nonblock</span>, <span class="ruby-identifier">consume_queue</span>=<span class="ruby-keyword kw">true</span>)
164:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
165:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">consume_queue</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">any?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">first</span>)
166:           <span class="ruby-keyword kw">return</span> <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">shift</span>
167:         <span class="ruby-keyword kw">end</span>
168: 
169:         <span class="ruby-identifier">packet</span> = <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">next_packet</span>(<span class="ruby-identifier">mode</span>)
170:         <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">nil?</span>
171: 
172:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">packet</span>.<span class="ruby-identifier">type</span>
173:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DISCONNECT</span>
174:           <span class="ruby-identifier">raise</span> <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Disconnect</span>, <span class="ruby-node">&quot;disconnected: #{packet[:description]} (#{packet[:reason_code]})&quot;</span>
175: 
176:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">IGNORE</span>
177:           <span class="ruby-identifier">debug</span> { <span class="ruby-node">&quot;IGNORE packet recieved: #{packet[:data].inspect}&quot;</span> }
178: 
179:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">UNIMPLEMENTED</span>
180:           <span class="ruby-identifier">lwarn</span> { <span class="ruby-node">&quot;UNIMPLEMENTED: #{packet[:number]}&quot;</span> }
181: 
182:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">DEBUG</span>
183:           <span class="ruby-identifier">send</span>(<span class="ruby-identifier">packet</span>[<span class="ruby-identifier">:always_display</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">:fatal</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">:debug</span>) { <span class="ruby-identifier">packet</span>[<span class="ruby-identifier">:message</span>] }
184: 
185:         <span class="ruby-keyword kw">when</span> <span class="ruby-constant">KEXINIT</span>
186:           <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">accept_kexinit</span>(<span class="ruby-identifier">packet</span>)
187: 
188:         <span class="ruby-keyword kw">else</span>
189:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">packet</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">allow?</span>(<span class="ruby-identifier">packet</span>)
190:           <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)
191:         <span class="ruby-keyword kw">end</span>
192:       <span class="ruby-keyword kw">end</span>
193:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000052" class="method-detail">
        <a name="M000052"></a>

        <div class="method-heading">
          <a href="#M000052" class="method-signature">
          <span class="method-name">push</span><span class="method-args">(packet)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Adds the given packet to the packet queue. If the queue is non-empty, <a
href="Session.html#M000050">poll_message</a> will return packets from the
queue in the order they were received.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000052-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000052-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 210</span>
210:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)
211:       <span class="ruby-ivar">@queue</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">packet</span>)
212:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000046" class="method-detail">
        <a name="M000046"></a>

        <div class="method-heading">
          <a href="#M000046" class="method-signature">
          <span class="method-name">rekey!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Requests a rekey operation, and blocks until the operation completes. If a
rekey is already pending, this returns immediately, having no effect.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000046-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000046-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 125</span>
125:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rekey!</span>
126:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>
127:         <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">rekey!</span>
128:         <span class="ruby-identifier">wait</span> { <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">initialized?</span> }
129:       <span class="ruby-keyword kw">end</span>
130:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000047" class="method-detail">
        <a name="M000047"></a>

        <div class="method-heading">
          <a href="#M000047" class="method-signature">
          <span class="method-name">rekey_as_needed</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns immediately if a rekey is already in process. Otherwise, if a rekey
is needed (as indicated by the socket, see PacketStream#if_needs_rekey?)
one is performed, causing this method to block until it completes.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000047-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000047-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 135</span>
135:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rekey_as_needed</span>
136:       <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">algorithms</span>.<span class="ruby-identifier">pending?</span>
137:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">if_needs_rekey?</span> { <span class="ruby-identifier">rekey!</span> }
138:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000053" class="method-detail">
        <a name="M000053"></a>

        <div class="method-heading">
          <a href="#M000053" class="method-signature">
          <span class="method-name">send_message</span><span class="method-args">(message)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Sends the given message via the packet stream, blocking until the entire
message has been sent.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000053-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000053-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 216</span>
216:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">send_message</span>(<span class="ruby-identifier">message</span>)
217:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">send_packet</span>(<span class="ruby-identifier">message</span>)
218:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000045" class="method-detail">
        <a name="M000045"></a>

        <div class="method-heading">
          <a href="#M000045" class="method-signature">
          <span class="method-name">service_request</span><span class="method-args">(service)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Returns a <a href="Session.html#M000040">new</a> <a
href="Session.html#M000045">service_request</a> packet for the given
service name, ready for sending to the server.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000045-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000045-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 118</span>
118:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">service_request</span>(<span class="ruby-identifier">service</span>)
119:       <span class="ruby-constant">Net</span><span class="ruby-operator">::</span><span class="ruby-constant">SSH</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffer</span>.<span class="ruby-identifier">from</span>(<span class="ruby-identifier">:byte</span>, <span class="ruby-constant">SERVICE_REQUEST</span>, <span class="ruby-identifier">:string</span>, <span class="ruby-identifier">service</span>)
120:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000044" class="method-detail">
        <a name="M000044"></a>

        <div class="method-heading">
          <a href="#M000044" class="method-signature">
          <span class="method-name">shutdown!</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Performs a &quot;hard&quot; shutdown of the connection. In general, this
should never be done, but it might be necessary (in a rescue clause, for
instance, when the connection needs to <a
href="Session.html#M000043">close</a> but you don&#8216;t know the status
of the underlying protocol&#8216;s state).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000044-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000044-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 111</span>
111:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">shutdown!</span>
112:       <span class="ruby-identifier">error</span> { <span class="ruby-value str">&quot;forcing connection closed&quot;</span> }
113:       <span class="ruby-identifier">socket</span>.<span class="ruby-identifier">close</span>
114:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000051" class="method-detail">
        <a name="M000051"></a>

        <div class="method-heading">
          <a href="#M000051" class="method-signature">
          <span class="method-name">wait</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Waits (blocks) until the given block returns true. If no block is given,
this just waits long enough to see if there are any pending packets. Any
packets read are enqueued (see <a href="Session.html#M000052">push</a>).
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000051-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000051-source">
<pre>
     <span class="ruby-comment cmt"># File lib/net/ssh/transport/session.rb, line 198</span>
198:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">wait</span>
199:       <span class="ruby-identifier">loop</span> <span class="ruby-keyword kw">do</span>
200:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-keyword kw">yield</span>
201:         <span class="ruby-identifier">message</span> = <span class="ruby-identifier">poll_message</span>(<span class="ruby-identifier">:nonblock</span>, <span class="ruby-keyword kw">false</span>)
202:         <span class="ruby-identifier">push</span>(<span class="ruby-identifier">message</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">message</span>
203:         <span class="ruby-keyword kw">break</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">block_given?</span>
204:       <span class="ruby-keyword kw">end</span>
205:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>